<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Akka-Remote-收消息 | Hexo</title>
  <meta name="description" content="1.概述在上文中，我们分析了网络链接建立的过程，一旦建立就可以正常的收发消息了。  发送消息的细节不再分析，因为对于本地的actor来说这个过程相对简单，它只是创立链接然后给指定的netty网路服务发送消息就好了。 接收消息就比较麻烦了，因为这对于actor来说是透明的，netty收到消息后如何把消息分发给指定的actor呢？这个分发的过程值得研究研究。2.Actor触发Akka的收消息是从mai">
<meta property="og:type" content="article">
<meta property="og:title" content="Akka-Remote-收消息">
<meta property="og:url" content="https://wuhaocn.github.io/2021/12/03/network/akka/Akka-Remote-%E6%94%B6%E6%B6%88%E6%81%AF/index.html">
<meta property="og:site_name" content="wuhaocn">
<meta property="og:description" content="1.概述在上文中，我们分析了网络链接建立的过程，一旦建立就可以正常的收发消息了。  发送消息的细节不再分析，因为对于本地的actor来说这个过程相对简单，它只是创立链接然后给指定的netty网路服务发送消息就好了。 接收消息就比较麻烦了，因为这对于actor来说是透明的，netty收到消息后如何把消息分发给指定的actor呢？这个分发的过程值得研究研究。2.Actor触发Akka的收消息是从mai">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632968210922-098d3766-4937-45ca-aa4e-695901e8be11.png#clientId=u36dc08b3-c1fa-4&from=paste&height=390&id=u3bfadf91&margin=%5Bobject%20Object%5D&name=image.png&originHeight=442&originWidth=809&originalType=binary&ratio=1&size=67385&status=done&style=none&taskId=uf5ce47b1-cb0f-44bd-ac69-efa776b5a0f&width=713.5">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632967070768-848bae89-41a5-4f22-8d49-d10dd5192725.png#clientId=u36dc08b3-c1fa-4&from=paste&height=380&id=uff013532&margin=%5Bobject%20Object%5D&name=image.png&originHeight=760&originWidth=1630&originalType=binary&ratio=1&size=691247&status=done&style=none&taskId=u2651f574-c875-45f2-9368-cc0964303a4&width=815">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632652170834-4126b27a-81fd-41d9-858f-5315162d46e9.png#clientId=u15d7a13d-fab5-4&from=paste&id=u69c57aba&margin=%5Bobject%20Object%5D&originHeight=494&originWidth=931&originalType=url&ratio=1&status=done&style=none&taskId=u48b42796-f94c-4a82-b9a1-c5dbd8013e6">
<meta property="article:published_time" content="2021-12-03T07:49:10.532Z">
<meta property="article:modified_time" content="2021-12-03T09:07:15.165Z">
<meta property="article:author" content="wuhao">
<meta property="article:tag" content="akka">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632968210922-098d3766-4937-45ca-aa4e-695901e8be11.png#clientId=u36dc08b3-c1fa-4&from=paste&height=390&id=u3bfadf91&margin=%5Bobject%20Object%5D&name=image.png&originHeight=442&originWidth=809&originalType=binary&ratio=1&size=67385&status=done&style=none&taskId=uf5ce47b1-cb0f-44bd-ac69-efa776b5a0f&width=713.5">
  <!-- Canonical links -->
  <link rel="canonical" href="https://wuhaocn.github.io/2021/12/03/network/akka/Akka-Remote-%E6%94%B6%E6%B6%88%E6%81%AF/index.html">
  
    <link rel="alternate" href="/atom.xml" title="wuhaocn" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/wuhaocn" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">wuhaocn</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Java &amp; 后端 &amp; 通信</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> BeiJing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">书单</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/wuhaocn" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/5G/">5G</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/devops/">devops</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9F%AD%E4%BF%A1/">短信</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80-shell/">编程语言 - shell</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/5G/" rel="tag">5G</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/" rel="tag">AOP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DPDK/" rel="tag">DPDK</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MEC/" rel="tag">MEC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NGAP/" rel="tag">NGAP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ai/" rel="tag">ai</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/akka/" rel="tag">akka</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/atomic/" rel="tag">atomic</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/brew/" rel="tag">brew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmpp/" rel="tag">cmpp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/" rel="tag">design</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftp/" rel="tag">ftp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grafana/" rel="tag">grafana</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/" rel="tag">jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log4j/" rel="tag">log4j</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nexus/" rel="tag">nexus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prometheus/" rel="tag">prometheus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/" rel="tag">sort</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF/" rel="tag">动态调试技术</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E8%8A%82%E7%A0%81/" rel="tag">字节码</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%88%87%E7%89%87/" rel="tag">网络切片</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/5G/" style="font-size: 13.33px;">5G</a> <a href="/tags/AOP/" style="font-size: 13px;">AOP</a> <a href="/tags/DPDK/" style="font-size: 13.17px;">DPDK</a> <a href="/tags/JVM/" style="font-size: 13.67px;">JVM</a> <a href="/tags/MEC/" style="font-size: 13px;">MEC</a> <a href="/tags/NGAP/" style="font-size: 13px;">NGAP</a> <a href="/tags/ai/" style="font-size: 13px;">ai</a> <a href="/tags/akka/" style="font-size: 14px;">akka</a> <a href="/tags/atomic/" style="font-size: 13.33px;">atomic</a> <a href="/tags/brew/" style="font-size: 13px;">brew</a> <a href="/tags/cmpp/" style="font-size: 13px;">cmpp</a> <a href="/tags/design/" style="font-size: 13px;">design</a> <a href="/tags/docker/" style="font-size: 13.5px;">docker</a> <a href="/tags/ftp/" style="font-size: 13px;">ftp</a> <a href="/tags/grafana/" style="font-size: 13px;">grafana</a> <a href="/tags/java/" style="font-size: 13px;">java</a> <a href="/tags/jenkins/" style="font-size: 13px;">jenkins</a> <a href="/tags/log4j/" style="font-size: 13px;">log4j</a> <a href="/tags/nexus/" style="font-size: 13px;">nexus</a> <a href="/tags/prometheus/" style="font-size: 13px;">prometheus</a> <a href="/tags/sort/" style="font-size: 13.83px;">sort</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF/" style="font-size: 13px;">动态调试技术</a> <a href="/tags/%E5%AD%97%E8%8A%82%E7%A0%81/" style="font-size: 13.33px;">字节码</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%88%87%E7%89%87/" style="font-size: 13px;">网络切片</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">24</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/java/">java</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/17/language/java/log4j/log4j%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D%E5%8F%8A%E9%98%B2%E6%8A%A4/" class="title">log4j漏洞介绍及防护</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-17T07:59:58.675Z" itemprop="datePublished">2021-12-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-SLF4J%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97/" class="title">Akka-SLF4J打印日志</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T09:08:28.304Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-Remote-%E9%85%8D%E7%BD%AE/" class="title">Akka-Remote-配置</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T08:24:00.895Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-%E6%8C%81%E4%B9%85%E5%8C%96-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E6%8E%A5%E6%94%B6/" class="title">Akka-持久化-消息发送与接收</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T08:23:51.202Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-Actor-DeadLetter%E7%9B%91%E5%90%AC/" class="title">Akka-Actor-DeadLetter监听</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T08:22:48.138Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<meta name="referrer" content="no-referrer" />
<main class="main" role="main">
  <div class="content">
  <article id="post-network/akka/Akka-Remote-收消息" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Akka-Remote-收消息
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/12/03/network/akka/Akka-Remote-%E6%94%B6%E6%B6%88%E6%81%AF/" class="article-date">
	  <time datetime="2021-12-03T07:49:10.532Z" itemprop="datePublished">2021-12-03</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/network/">network</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/akka/" rel="tag">akka</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/12/03/network/akka/Akka-Remote-%E6%94%B6%E6%B6%88%E6%81%AF/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><p>在上文中，我们分析了网络链接建立的过程，一旦建立就可以正常的收发消息了。</p>
<ul>
<li>发送消息的细节不再分析，因为对于本地的actor来说这个过程相对简单，它只是创立链接然后给指定的netty网路服务发送消息就好了。</li>
<li>接收消息就比较麻烦了，因为这对于actor来说是透明的，netty收到消息后如何把消息分发给指定的actor呢？这个分发的过程值得研究研究。<h2 id="2-Actor触发"><a href="#2-Actor触发" class="headerlink" title="2.Actor触发"></a>2.Actor触发</h2>Akka的收消息是从mailbox里面消费消息,消费成功后触发业务Actor的onReceive，详细调用链如下：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/804884/1632968210922-098d3766-4937-45ca-aa4e-695901e8be11.png#clientId=u36dc08b3-c1fa-4&from=paste&height=390&id=u3bfadf91&margin=%5Bobject%20Object%5D&name=image.png&originHeight=442&originWidth=809&originalType=binary&ratio=1&size=67385&status=done&style=none&taskId=uf5ce47b1-cb0f-44bd-ac69-efa776b5a0f&width=713.5" alt="image.png"><br>调用堆栈如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">onReceive:<span class="number">19</span>, ClientActor (com.rcloud.akka.server.cmp)</span><br><span class="line">applyOrElse:<span class="number">167</span>, UntypedActor$$anonfun$receive$<span class="number">1</span> (akka.actor)</span><br><span class="line">aroundReceive:<span class="number">465</span>, Actor$<span class="class"><span class="keyword">class</span> (<span class="title">akka</span>.<span class="title">actor</span>)</span></span><br><span class="line"><span class="class"><span class="title">aroundReceive</span>:97, <span class="title">UntypedActor</span> (<span class="title">akka</span>.<span class="title">actor</span>)</span></span><br><span class="line"><span class="class"><span class="title">receiveMessage</span>:516, <span class="title">ActorCell</span> (<span class="title">akka</span>.<span class="title">actor</span>)</span></span><br><span class="line"><span class="class"><span class="title">invoke</span>:487, <span class="title">ActorCell</span> (<span class="title">akka</span>.<span class="title">actor</span>)</span></span><br><span class="line"><span class="class"><span class="title">processMailbox</span>:238, <span class="title">Mailbox</span> (<span class="title">akka</span>.<span class="title">dispatch</span>)</span></span><br><span class="line"><span class="class"><span class="title">run</span>:220, <span class="title">Mailbox</span> (<span class="title">akka</span>.<span class="title">dispatch</span>)</span></span><br><span class="line"><span class="class"><span class="title">exec</span>:393, <span class="title">ForkJoinExecutorConfigurator</span>$<span class="title">AkkaForkJoinTask</span> (<span class="title">akka</span>.<span class="title">dispatch</span>)</span></span><br><span class="line"><span class="class"><span class="title">doExec</span>:260, <span class="title">ForkJoinTask</span> (<span class="title">scala</span>.<span class="title">concurrent</span>.<span class="title">forkjoin</span>)</span></span><br><span class="line"><span class="class"><span class="title">runTask</span>:1339, <span class="title">ForkJoinPool</span>$<span class="title">WorkQueue</span> (<span class="title">scala</span>.<span class="title">concurrent</span>.<span class="title">forkjoin</span>)</span></span><br><span class="line"><span class="class"><span class="title">runWorker</span>:1979, <span class="title">ForkJoinPool</span> (<span class="title">scala</span>.<span class="title">concurrent</span>.<span class="title">forkjoin</span>)</span></span><br><span class="line"><span class="class"><span class="title">run</span>:107, <span class="title">ForkJoinWorkerThread</span> (<span class="title">scala</span>.<span class="title">concurrent</span>.<span class="title">forkjoin</span>)</span></span><br></pre></td></tr></table></figure>
相关值如下：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/804884/1632967070768-848bae89-41a5-4f22-8d49-d10dd5192725.png#clientId=u36dc08b3-c1fa-4&from=paste&height=380&id=uff013532&margin=%5Bobject%20Object%5D&name=image.png&originHeight=760&originWidth=1630&originalType=binary&ratio=1&size=691247&status=done&style=none&taskId=u2651f574-c875-45f2-9368-cc0964303a4&width=815" alt="image.png"><br>那消息是如何推送到mailbox呢，详细见下文分析<h2 id="3-网络层触发"><a href="#3-网络层触发" class="headerlink" title="3.网络层触发"></a>3.网络层触发</h2><h3 id="3-1-网络管理"><a href="#3-1-网络管理" class="headerlink" title="3.1 网络管理"></a>3.1 网络管理</h3>之前分析过，在监听创立的过程中，有一个对象非常关键：TcpServerHandler。它负责链接建立、消息收发等功能。TcpServerHandler继承了ServerHandler<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>[netty] <span class="function"><span class="keyword">abstract</span> class <span class="title">ServerHandler</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="keyword">protected</span> <span class="keyword">final</span> val transport:               NettyTransport,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="keyword">private</span> <span class="keyword">final</span> val associationListenerFuture: Future[AssociationEventListener])</span></span></span><br><span class="line"><span class="function">  extends NettyServerHelpers with CommonHandlers</span></span><br></pre></td></tr></table></figure>
ServerHandler继承了NettyServerHelpers<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>[netty] trait NettyServerHelpers extends SimpleChannelUpstreamHandler with NettyHelpers &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">final</span> override def <span class="title">messageReceived</span><span class="params">(ctx: ChannelHandlerContext, e: MessageEvent)</span>: Unit </span>= &#123;</span><br><span class="line">    <span class="keyword">super</span>.messageReceived(ctx, e)</span><br><span class="line">    onMessage(ctx, e)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">final</span> override def <span class="title">exceptionCaught</span><span class="params">(ctx: ChannelHandlerContext, e: ExceptionEvent)</span>: Unit </span>= transformException(ctx, e)</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">final</span> override def <span class="title">channelConnected</span><span class="params">(ctx: ChannelHandlerContext, e: ChannelStateEvent)</span>: Unit </span>= &#123;</span><br><span class="line">    <span class="keyword">super</span>.channelConnected(ctx, e)</span><br><span class="line">    onConnect(ctx, e)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">final</span> override def <span class="title">channelOpen</span><span class="params">(ctx: ChannelHandlerContext, e: ChannelStateEvent)</span>: Unit </span>= &#123;</span><br><span class="line">    <span class="keyword">super</span>.channelOpen(ctx, e)</span><br><span class="line">    onOpen(ctx, e)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">final</span> override def <span class="title">channelDisconnected</span><span class="params">(ctx: ChannelHandlerContext, e: ChannelStateEvent)</span>: Unit </span>= &#123;</span><br><span class="line">    <span class="keyword">super</span>.channelDisconnected(ctx, e)</span><br><span class="line">    onDisconnect(ctx, e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
很明显NettyServerHelpers有一个messageReceived应该就是收到消息时回调的方法，那onMessage在哪里实现呢？TcpServerHandler还继承了TcpHandlers，我们来看看TcpHandlers的onMessage方法。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override def <span class="title">onMessage</span><span class="params">(ctx: ChannelHandlerContext, e: MessageEvent)</span>: Unit </span>= &#123;</span><br><span class="line">   val bytes: Array[Byte] = e.getMessage.asInstanceOf[ChannelBuffer].array()</span><br><span class="line">   <span class="keyword">if</span> (bytes.length &gt; <span class="number">0</span>) notifyListener(e.getChannel, InboundPayload(ByteString(bytes)))</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
它最终用InboundPayload封装了收到的数据，并调用了ChannelLocalActor.notifyListener方法。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>[remote] object ChannelLocalActor extends ChannelLocal[Option[HandleEventListener]] &#123;</span><br><span class="line">  <span class="function">override def <span class="title">initialValue</span><span class="params">(channel: Channel)</span>: Option[HandleEventListener] </span>= <span class="function">None</span></span><br><span class="line"><span class="function">  def <span class="title">notifyListener</span><span class="params">(channel: Channel, msg: HandleEvent)</span>: Unit </span>= get(channel) foreach &#123; _ notify msg &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
ChannelLocalActor可以先把它理解成一个ThreadLocal对象，其他的技术细节读者可以自行谷歌。notifyListener只调用了get，那具体是在哪里set的呢？通过channel变量get到的Option[HandleEventListener]又是在哪里赋值的呢？<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override def <span class="title">registerListener</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  channel:             Channel,</span></span></span><br><span class="line"><span class="params"><span class="function">  listener:            HandleEventListener,</span></span></span><br><span class="line"><span class="params"><span class="function">  msg:                 ChannelBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">  remoteSocketAddress: InetSocketAddress)</span>: Unit </span>= ChannelLocalActor.set(channel, Some(listener))</span><br></pre></td></tr></table></figure>
很显然是在registerListener时set的值，那registerListener在哪里调用呢？如果读过上一篇的文章，一定会知道ServerHandler.initInbound函数，这个函数调用了CommonHandlers.init<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">protected</span> def <span class="title">init</span><span class="params">(channel: Channel, remoteSocketAddress: SocketAddress, remoteAddress: Address, msg: ChannelBuffer)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    op: (AssociationHandle ⇒ Any)</span>): Unit </span>= &#123;</span><br><span class="line">    <span class="keyword">import</span> transport._</span><br><span class="line">    NettyTransport.addressFromSocketAddress(channel.getLocalAddress, schemeIdentifier, system.name, Some(settings.Hostname), None) match &#123;</span><br><span class="line">      <span class="function"><span class="keyword">case</span> <span class="title">Some</span><span class="params">(localAddress)</span> ⇒</span></span><br><span class="line"><span class="function">        val handle </span>= createHandle(channel, localAddress, remoteAddress)</span><br><span class="line">        handle.readHandlerPromise.future.foreach &#123;</span><br><span class="line">          listener ⇒</span><br><span class="line">            registerListener(channel, listener, msg, remoteSocketAddress.asInstanceOf[InetSocketAddress])</span><br><span class="line">            channel.setReadable(<span class="keyword">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        op(handle)</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">case</span> _ ⇒ NettyTransport.gracefulClose(channel)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>上面的函数中调用了registerListener，那listener具体在哪里创建的呢，或者是哪个变量对应的值呢？这就需要研究createHandle对象及其返回值是什么了。经过分析还是找到了TcpHandlers这个trait，里面有createHandle的具体实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override def <span class="title">createHandle</span><span class="params">(channel: Channel, localAddress: Address, remoteAddress: Address)</span>: AssociationHandle </span>=</span><br><span class="line">  <span class="keyword">new</span> TcpAssociationHandle(localAddress, remoteAddress, transport, channel)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>TcpAssociationHandle源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>[remote] <span class="class"><span class="keyword">class</span> <span class="title">TcpAssociationHandle</span>(</span></span><br><span class="line"><span class="class">  <span class="title">val</span> <span class="title">localAddress</span>:    <span class="title">Address</span>,</span></span><br><span class="line"><span class="class">  <span class="title">val</span> <span class="title">remoteAddress</span>:   <span class="title">Address</span>,</span></span><br><span class="line"><span class="class">  <span class="title">val</span> <span class="title">transport</span>:       <span class="title">NettyTransport</span>,</span></span><br><span class="line"><span class="class">  <span class="title">private</span> <span class="title">val</span> <span class="title">channel</span>: <span class="title">Channel</span>)</span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">AssociationHandle</span> </span>&#123;</span><br><span class="line">  <span class="keyword">import</span> transport.executionContext</span><br><span class="line"> </span><br><span class="line">  override val readHandlerPromise: Promise[HandleEventListener] = Promise()</span><br><span class="line"> </span><br><span class="line">  <span class="function">override def <span class="title">write</span><span class="params">(payload: ByteString)</span>: Boolean </span>=</span><br><span class="line">    <span class="keyword">if</span> (channel.isWritable &amp;&amp; channel.isOpen) &#123;</span><br><span class="line">      channel.write(ChannelBuffers.wrappedBuffer(payload.asByteBuffer))</span><br><span class="line">      <span class="keyword">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="function"><span class="keyword">false</span></span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function">  override def <span class="title">disassociate</span><span class="params">()</span>: Unit </span>= NettyTransport.gracefulClose(channel)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-2-节点管理"><a href="#3-2-节点管理" class="headerlink" title="3.2 节点管理"></a>3.2 节点管理</h3><pre><code>  由此可见，readHandlerPromise是一个Promise[HandleEventListener]，并没有具体赋值的逻辑，这就要去使用TcpAssociationHandle的相关代码找相关的赋值逻辑了。TcpAssociationHandle在哪里使用呢？还记得handleInboundAssociation建立连接的过程吗？它最终调用了createAndRegisterEndpoint
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> def <span class="title">createAndRegisterEndpoint</span><span class="params">(handle: AkkaProtocolHandle)</span>: Unit </span>= &#123;</span><br><span class="line">  val writing = settings.UsePassiveConnections &amp;&amp; !endpoints.hasWritableEndpointFor(handle.remoteAddress)</span><br><span class="line">  eventPublisher.notifyListeners(AssociatedEvent(handle.localAddress, handle.remoteAddress, inbound = <span class="keyword">true</span>))</span><br><span class="line"> </span><br><span class="line">  val endpoint = createEndpoint(</span><br><span class="line">    handle.remoteAddress,</span><br><span class="line">    handle.localAddress,</span><br><span class="line">    transportMapping(handle.localAddress),</span><br><span class="line">    settings,</span><br><span class="line">    Some(handle),</span><br><span class="line">    writing)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (writing)</span><br><span class="line">    endpoints.registerWritableEndpoint(handle.remoteAddress, Some(handle.handshakeInfo.uid), endpoint)</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    endpoints.registerReadOnlyEndpoint(handle.remoteAddress, endpoint, handle.handshakeInfo.uid)</span><br><span class="line">    <span class="keyword">if</span> (!endpoints.hasWritableEndpointFor(handle.remoteAddress))</span><br><span class="line">      endpoints.removePolicy(handle.remoteAddress)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>createAndRegisterEndpoint拿着一个连接实例AkkaProtocolHandle创建了一个endpoint，其中有个很关键的字段writing，它是true还是false呢？UsePassiveConnections默认为true，且经分析!endpoints.hasWritableEndpointFor(handle.remoteAddress)应该也是true，所以writing是true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Reuse inbound connections <span class="keyword">for</span> outbound messages</span><br><span class="line">use-passive-connections = on</span><br></pre></td></tr></table></figure>
<p>ReliableDeliverySupervisor其实是对EndpointWriter的代理。在创建ReliableDeliverySupervisor的过程中AkkaProtocolHandle是作为参数传入的，也就监听到连接消息后创建的handle。而在创建EndpointWriter的过程中，这个handle又是作为第一个参数传入了EndpointWriter。我们来看看EndpointWriter是如何使用这个handle的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override def <span class="title">preStart</span><span class="params">()</span>: Unit </span>= &#123;</span><br><span class="line">   handle match &#123;</span><br><span class="line">     <span class="function"><span class="keyword">case</span> <span class="title">Some</span><span class="params">(h)</span> ⇒</span></span><br><span class="line"><span class="function">       reader </span>= startReadEndpoint(h)</span><br><span class="line">     <span class="keyword">case</span> None ⇒</span><br><span class="line">       transport.associate(remoteAddress, refuseUid).map(Handle(_)) pipeTo self</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>在preStart时，handle应该是有值的，如果有值，就调用了startReadEndpoint(h)方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> def <span class="title">startReadEndpoint</span><span class="params">(handle: AkkaProtocolHandle)</span>: Some[ActorRef] </span>= &#123;</span><br><span class="line">    val newReader =</span><br><span class="line">      context.watch(context.actorOf(</span><br><span class="line">        RARP(context.system).configureDispatcher(EndpointReader.props(localAddress, remoteAddress, transport, settings, codec,</span><br><span class="line">          msgDispatch, inbound, handle.handshakeInfo.uid, reliableDeliverySupervisor, receiveBuffers)).withDeploy(Deploy.local),</span><br><span class="line">        <span class="string">&quot;endpointReader-&quot;</span> + AddressUrlEncoder(remoteAddress) + <span class="string">&quot;-&quot;</span> + readerId.next()))</span><br><span class="line">    handle.readHandlerPromise.success(ActorHandleEventListener(newReader))</span><br><span class="line">    Some(newReader)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>startReadEndpoint做了什么呢？它又创建了一个Actor：EndpointReader！！！好多中间的actor创建。创建之后，调用了handle.readHandlerPromise.success(ActorHandleEventListener(newReader))给handle.readHandlerPromise。还记得ActorHandleEventListener吗，它就是把收到的消息转发了对应的actor，此处就是newReader。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/804884/1632652170834-4126b27a-81fd-41d9-858f-5315162d46e9.png#clientId=u15d7a13d-fab5-4&from=paste&id=u69c57aba&margin=%5Bobject%20Object%5D&originHeight=494&originWidth=931&originalType=url&ratio=1&status=done&style=none&taskId=u48b42796-f94c-4a82-b9a1-c5dbd8013e6"></p>
<h3 id="3-3-消息解码"><a href="#3-3-消息解码" class="headerlink" title="3.3 消息解码"></a>3.3 消息解码</h3><p>EndpointReader如何处理InboundPayload消息呢？首先解码收到的消息，然后给创建它的reliableDelivery发送ack消息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override def <span class="title">decodeMessage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  raw:          ByteString,</span></span></span><br><span class="line"><span class="params"><span class="function">  provider:     RemoteActorRefProvider,</span></span></span><br><span class="line"><span class="params"><span class="function">  localAddress: Address)</span>: <span class="params">(Option[Ack], Option[Message])</span> </span>= &#123;</span><br><span class="line">  val ackAndEnvelope = AckAndEnvelopeContainer.parseFrom(raw.toArray)</span><br><span class="line"> </span><br><span class="line">  val ackOption = <span class="keyword">if</span> (ackAndEnvelope.hasAck) &#123;</span><br><span class="line">    <span class="keyword">import</span> scala.collection.JavaConverters.<span class="function">_</span></span><br><span class="line"><span class="function">    <span class="title">Some</span><span class="params">(Ack(SeqNo(ackAndEnvelope.getAck.getCumulativeAck)</span>, ackAndEnvelope.getAck.getNacksList.asScala.<span class="title">map</span><span class="params">(SeqNo(_)</span>).toSet))</span></span><br><span class="line"><span class="function">  &#125; <span class="keyword">else</span> None</span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function">  val messageOption </span>= <span class="keyword">if</span> (ackAndEnvelope.hasEnvelope) &#123;</span><br><span class="line">    val msgPdu = ackAndEnvelope.<span class="function">getEnvelope</span></span><br><span class="line"><span class="function">    <span class="title">Some</span><span class="params">(Message(</span></span></span><br><span class="line"><span class="params"><span class="function">      recipient = provider.resolveActorRefWithLocalAddress(msgPdu.getRecipient.getPath, localAddress)</span>,</span></span><br><span class="line"><span class="function">      recipientAddress </span>= AddressFromURIString(msgPdu.getRecipient.getPath),</span><br><span class="line">      serializedMessage = msgPdu.getMessage,</span><br><span class="line">      senderOption =</span><br><span class="line">        <span class="keyword">if</span> (msgPdu.hasSender) OptionVal(provider.resolveActorRefWithLocalAddress(msgPdu.getSender.getPath, localAddress))</span><br><span class="line">        <span class="keyword">else</span> OptionVal.None,</span><br><span class="line">      seqOption =</span><br><span class="line">        <span class="keyword">if</span> (msgPdu.hasSeq) Some(SeqNo(msgPdu.getSeq)) <span class="keyword">else</span> None))</span><br><span class="line">  &#125; <span class="keyword">else</span> None</span><br><span class="line"> </span><br><span class="line">  (ackOption, messageOption)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>上面是decodeMessage的源码，消息最终被decode成了Message对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">case</span> class <span class="title">Message</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  recipient:         InternalActorRef,</span></span></span><br><span class="line"><span class="params"><span class="function">  recipientAddress:  Address,</span></span></span><br><span class="line"><span class="params"><span class="function">  serializedMessage: SerializedMessage,</span></span></span><br><span class="line"><span class="params"><span class="function">  senderOption:      OptionVal[ActorRef],</span></span></span><br><span class="line"><span class="params"><span class="function">  seqOption:         Option[SeqNo])</span> extends HasSequenceNumber </span>&#123;</span><br><span class="line"> </span><br><span class="line">  def reliableDeliveryEnabled = seqOption.isDefined</span><br><span class="line"> </span><br><span class="line">  override def seq: SeqNo = seqOption.get</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>默认情况下reliableDeliveryEnabled是false的，因为发送出去的msgPdu是没有getSeq的，因为默认的tcp是保证消息发送的。所以EndpointReader收到消息后调用了msgDispatch.dispatch把消息分发出去了。根据上下文msgDispatch是在EndpointWriter创建的，代码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">val msgDispatch = <span class="keyword">new</span> DefaultMessageDispatcher(extendedSystem, provider, markLog)</span><br></pre></td></tr></table></figure>
<p>DefaultMessageDispatcher.dispatch不再具体分析，它就是把消息tell给了Message.recipient，而recipient是一个InternalActorRef，对的，你没有看错，这就是一个InternalActorRef，是不是很神奇，payload解码之后直接就有目标actor的InternalActorRef了？？！！那我们就得好好看看是如何对payload进行解码的了。<br>在decodeMessage函数中，有两处代码非常关键：“recipient = provider.resolveActorRefWithLocalAddress(msgPdu.getRecipient.getPath, localAddress)”、“if (msgPdu.hasSender) OptionVal(provider.resolveActorRefWithLocalAddress(msgPdu.getSender.getPath, localAddress))”。都是调用provider.resolveActorRefWithLocalAddress函数通过actor的path转化成了对应actor的ActorRef，很显然provider就是RemoteActorRefProvider。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * INTERNAL API</span></span><br><span class="line"><span class="comment">   * Called in deserialization of incoming remote messages where the correct local address is known.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span>[akka] <span class="function">def <span class="title">resolveActorRefWithLocalAddress</span><span class="params">(path: String, localAddress: Address)</span>: InternalActorRef </span>= &#123;</span><br><span class="line">    path match &#123;</span><br><span class="line">      <span class="function"><span class="keyword">case</span> <span class="title">ActorPathExtractor</span><span class="params">(address, elems)</span> ⇒</span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(hasAddress(address)</span>)</span></span><br><span class="line"><span class="function">          local.<span class="title">resolveActorRef</span><span class="params">(rootGuardian, elems)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">else</span> <span class="keyword">try</span> </span>&#123;</span><br><span class="line">          <span class="keyword">new</span> RemoteActorRef(transport, localAddress, RootActorPath(address) / elems, Nobody, props = None, deploy = None)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">          <span class="function"><span class="keyword">case</span> <span class="title">NonFatal</span><span class="params">(e)</span> ⇒</span></span><br><span class="line"><span class="function">            log.<span class="title">warning</span><span class="params">(<span class="string">&quot;Error while resolving ActorRef [&#123;&#125;] due to [&#123;&#125;]&quot;</span>, path, e.getMessage)</span></span></span><br><span class="line"><span class="function">            new <span class="title">EmptyLocalActorRef</span><span class="params">(<span class="keyword">this</span>, RootActorPath(address)</span> / elems, eventStream)</span></span><br><span class="line"><span class="function">        &#125;</span></span><br><span class="line"><span class="function">      <span class="keyword">case</span> _ ⇒</span></span><br><span class="line"><span class="function">        log.<span class="title">debug</span><span class="params">(<span class="string">&quot;Resolve (deserialization) of unknown (invalid) path [&#123;&#125;], using deadLetters.&quot;</span>, path)</span></span></span><br><span class="line"><span class="function">        deadLetters</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">  &#125;</span></span><br></pre></td></tr></table></figure>
<p>resolveActorRefWithLocalAddress也很简单，如果目标address包含在本机范围，就调用local.resolveActorRef，否则就创建RemoteActorRef，关于RemoteActorRef的作用这里不再讲解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * INTERNAL API</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span>[akka] <span class="function">def <span class="title">resolveActorRef</span><span class="params">(ref: InternalActorRef, pathElements: Iterable[String])</span>: InternalActorRef </span>=</span><br><span class="line">  <span class="keyword">if</span> (pathElements.isEmpty) &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;Resolve (deserialization) of empty path doesn&#x27;t match an active actor, using deadLetters.&quot;</span>)</span><br><span class="line">    deadLetters</span><br><span class="line">  &#125; <span class="keyword">else</span> ref.getChild(pathElements.iterator) match &#123;</span><br><span class="line">    <span class="keyword">case</span> Nobody ⇒</span><br><span class="line">      <span class="keyword">if</span> (log.isDebugEnabled)</span><br><span class="line">        log.debug(</span><br><span class="line">          <span class="string">&quot;Resolve (deserialization) of path [&#123;&#125;] doesn&#x27;t match an active actor. &quot;</span> +</span><br><span class="line">            <span class="string">&quot;It has probably been stopped, using deadLetters.&quot;</span>,</span><br><span class="line">          pathElements.mkString(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">      <span class="keyword">new</span> EmptyLocalActorRef(system.provider, ref.path / pathElements, eventStream)</span><br><span class="line">    <span class="keyword">case</span> x ⇒ x</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>LocalActorRefProvider.resolveActorRef也比较简单，就是调用ref.getChild，而ref是LocalActorRefProvider.rootGuardian，其实就是在本地范围内从root向下查找对应的ActorRef。<br>既然在收到消息时，是通过ActorPath找到对应的ActorRef的，那么发送消息的时候一定有把ActorRef转化成ActorPath的地方，关于这点我也带领大家验证一下。在之前的文章，我们分析过，发送消息是通过EndpointWriter.writeSend发送的，那就再来回顾一下这个函数。<br>​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">def <span class="title">writeSend</span><span class="params">(s: Send)</span>: Boolean </span>= <span class="keyword">try</span> &#123;</span><br><span class="line">    handle match &#123;</span><br><span class="line">      <span class="function"><span class="keyword">case</span> <span class="title">Some</span><span class="params">(h)</span> ⇒</span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(provider.remoteSettings.LogSend &amp;&amp; log.isDebugEnabled)</span> </span>&#123;</span><br><span class="line">          def msgLog = s<span class="string">&quot;RemoteMessage: [$&#123;s.message&#125;] to [$&#123;s.recipient&#125;]&lt;+[$&#123;s.recipient.path&#125;] from [$&#123;s.senderOption.getOrElse(extendedSystem.deadLetters)&#125;]&quot;</span></span><br><span class="line">          log.debug(<span class="string">&quot;sending message &#123;&#125;&quot;</span>, msgLog)</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        val pdu = codec.constructMessage(</span><br><span class="line">          s.recipient.localAddressToUse,</span><br><span class="line">          s.recipient,</span><br><span class="line">          serializeMessage(s.message),</span><br><span class="line">          s.senderOption,</span><br><span class="line">          seqOption = s.seqOpt,</span><br><span class="line">          ackOption = lastAck)</span><br><span class="line"> </span><br><span class="line">        val pduSize = pdu.size</span><br><span class="line">        remoteMetrics.logPayloadBytes(s.message, pduSize)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (pduSize &gt; transport.maximumPayloadBytes) &#123;</span><br><span class="line">          val reason = <span class="keyword">new</span> OversizedPayloadException(s<span class="string">&quot;Discarding oversized payload sent to $&#123;s.recipient&#125;: max allowed size $&#123;transport.maximumPayloadBytes&#125; bytes, actual size of encoded $&#123;s.message.getClass&#125; was $&#123;pdu.size&#125; bytes.&quot;</span>)</span><br><span class="line">          log.error(reason, <span class="string">&quot;Transient association error (association remains live)&quot;</span>)</span><br><span class="line">          <span class="keyword">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          val ok = h.write(pdu)</span><br><span class="line">          <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">            ackDeadline = newAckDeadline</span><br><span class="line">            lastAck = None</span><br><span class="line">          &#125;</span><br><span class="line">          ok</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">case</span> None ⇒</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> EndpointException(<span class="string">&quot;Internal error: Endpoint is in state Writing, but no association handle is present.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> e: NotSerializableException ⇒</span><br><span class="line">      log.error(e, <span class="string">&quot;Serializer not defined for message type [&#123;&#125;]. Transient association error (association remains live)&quot;</span>, s.message.getClass)</span><br><span class="line">      <span class="keyword">true</span></span><br><span class="line">    <span class="keyword">case</span> e: IllegalArgumentException ⇒</span><br><span class="line">      log.error(e, <span class="string">&quot;Serializer not defined for message type [&#123;&#125;]. Transient association error (association remains live)&quot;</span>, s.message.getClass)</span><br><span class="line">      <span class="keyword">true</span></span><br><span class="line">    <span class="keyword">case</span> e: MessageSerializer.SerializationException ⇒</span><br><span class="line">      log.error(e, <span class="string">&quot;&#123;&#125; Transient association error (association remains live)&quot;</span>, e.getMessage)</span><br><span class="line">      <span class="keyword">true</span></span><br><span class="line">    <span class="keyword">case</span> e: EndpointException ⇒</span><br><span class="line">      publishAndThrow(e, Logging.ErrorLevel)</span><br><span class="line">    <span class="function"><span class="keyword">case</span> <span class="title">NonFatal</span><span class="params">(e)</span> ⇒</span></span><br><span class="line"><span class="function">      <span class="title">publishAndThrow</span><span class="params">(new EndpointException(<span class="string">&quot;Failed to write message to the transport&quot;</span>, e)</span>, Logging.ErrorLevel)</span></span><br><span class="line"><span class="function">  &#125;</span></span><br></pre></td></tr></table></figure>


<p>在发送之前，调用了codec.constructMessage把消息相关的数据都编码进了pdu，具体如何进行编码的呢？<br>​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override def <span class="title">constructMessage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    localAddress:      Address,</span></span></span><br><span class="line"><span class="params"><span class="function">    recipient:         ActorRef,</span></span></span><br><span class="line"><span class="params"><span class="function">    serializedMessage: SerializedMessage,</span></span></span><br><span class="line"><span class="params"><span class="function">    senderOption:      OptionVal[ActorRef],</span></span></span><br><span class="line"><span class="params"><span class="function">    seqOption:         Option[SeqNo]       = None,</span></span></span><br><span class="line"><span class="params"><span class="function">    ackOption:         Option[Ack]         = None)</span>: ByteString </span>= &#123;</span><br><span class="line"> </span><br><span class="line">    val ackAndEnvelopeBuilder = AckAndEnvelopeContainer.newBuilder</span><br><span class="line"> </span><br><span class="line">    val envelopeBuilder = RemoteEnvelope.newBuilder</span><br><span class="line"> </span><br><span class="line">    envelopeBuilder.setRecipient(serializeActorRef(recipient.path.address, recipient))</span><br><span class="line">    senderOption match &#123;</span><br><span class="line">      <span class="keyword">case</span> OptionVal.Some(sender) ⇒ envelopeBuilder.setSender(serializeActorRef(localAddress, sender))</span><br><span class="line">      <span class="keyword">case</span> OptionVal.None         ⇒</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    seqOption foreach &#123; seq ⇒ envelopeBuilder.setSeq(seq.rawValue) &#125;</span><br><span class="line">    ackOption foreach &#123; ack ⇒ ackAndEnvelopeBuilder.setAck(ackBuilder(ack)) &#125;</span><br><span class="line">    envelopeBuilder.setMessage(serializedMessage)</span><br><span class="line">    ackAndEnvelopeBuilder.setEnvelope(envelopeBuilder)</span><br><span class="line"> </span><br><span class="line">    ByteString.ByteString1C(ackAndEnvelopeBuilder.build.toByteArray) <span class="comment">//Reuse Byte Array (naughty!)</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


<p>看到serializeActorRef了吗，它把ActorRef（这里分别是recipient和sender）进行了序列化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> def <span class="title">serializeActorRef</span><span class="params">(defaultAddress: Address, ref: ActorRef)</span>: ActorRefData </span>= &#123;</span><br><span class="line">    ActorRefData.newBuilder.setPath(</span><br><span class="line">      <span class="keyword">if</span> (ref.path.address.host.isDefined) ref.path.toSerializationFormat <span class="keyword">else</span> ref.path.toSerializationFormatWithAddress(defaultAddress)).build()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>其实serializeActorRef也比较简单，如果当前ActorRef是本地（有host字段）则直接调用path.toSerializationFormat，否则调用toSerializationFormatWithAddress(defaultAddress)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generate full String representation including the</span></span><br><span class="line"><span class="comment"> * uid for the actor cell instance as URI fragment.</span></span><br><span class="line"><span class="comment"> * This representation should be used as serialized</span></span><br><span class="line"><span class="comment"> * representation instead of `toString`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">def toSerializationFormat: String</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generate full String representation including the uid for the actor cell</span></span><br><span class="line"><span class="comment"> * instance as URI fragment, replacing the Address in the RootActor Path</span></span><br><span class="line"><span class="comment"> * with the given one unless this path’s address includes host and port</span></span><br><span class="line"><span class="comment"> * information. This representation should be used as serialized</span></span><br><span class="line"><span class="comment"> * representation instead of `toStringWithAddress`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">def <span class="title">toSerializationFormatWithAddress</span><span class="params">(address: Address)</span>: String</span></span><br></pre></td></tr></table></figure>
<p>toSerializationFormat和toSerializationFormatWithAddress的功能官网注释已经解释的很清楚，我就不啰嗦了，不过这直接验证了在发送消息时把ActorRef序列化成对应ActorPath的String的猜测。那么在收到消息时就可以通过ActorPath找到具体的ActorRef了。<br>至此remote模式下收发消息的过程我们就分析清楚了，如果还有不清楚的小伙伴就再把之前的文章复习一下，当然还可以在下面留言讨论。<br>​</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gabry/p/9390621.html">https://www.cnblogs.com/gabry/p/9390621.html</a></p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://wuhaocn.github.io/2021/12/03/network/akka/Akka-Remote-%E6%94%B6%E6%B6%88%E6%81%AF/" title="Akka-Remote-收消息" target="_blank" rel="external">https://wuhaocn.github.io/2021/12/03/network/akka/Akka-Remote-收消息/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/wuhaocn" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/wuhaocn" target="_blank"><span class="text-dark">wuhaocn</span><small class="ml-1x">Java &amp; 后端 &amp; 通信</small></a></h3>
        <div>个人简介。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/12/03/network/akka/Akka-Remote-%E5%BF%83%E8%B7%B3%E4%BF%9D%E6%B4%BB/" title="Akka-Remote-心跳保活"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/12/03/network/akka/Akka-Remote-%E5%8F%91%E6%B6%88%E6%81%AF/" title="Akka-Remote-发消息"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/wuhaocn" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/wuhaocn" target="_blank"> cofess </a>base on <a href="https://github.com/wuhaocn/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'UWmpsjuNfPNkkicYrPtMzVQC-gzGzoHsz',
    appKey: '825aG0XPHawp6VAXnYsrnlp3',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>