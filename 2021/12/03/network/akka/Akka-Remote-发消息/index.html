<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Akka-Remote-发消息 | Hexo</title>
  <meta name="description" content="1.概述 上文我们介绍了remote模式下Actor的创建，其实与local的创建并没有太大区别，一般情况下还是使用LocalActorRef创建了Actor。那么发消息是否意味着也是相同的呢？既然actorOf还是委托给了LocalActorRef，那么在本地创建的Actor发消息还是跟以前一样的，那么如果如何给远程的Actor发消息呢？我们一般是通过actorSelection或者给远程Act">
<meta property="og:type" content="article">
<meta property="og:title" content="Akka-Remote-发消息">
<meta property="og:url" content="https://wuhaocn.github.io/2021/12/03/network/akka/Akka-Remote-%E5%8F%91%E6%B6%88%E6%81%AF/index.html">
<meta property="og:site_name" content="wuhaocn">
<meta property="og:description" content="1.概述 上文我们介绍了remote模式下Actor的创建，其实与local的创建并没有太大区别，一般情况下还是使用LocalActorRef创建了Actor。那么发消息是否意味着也是相同的呢？既然actorOf还是委托给了LocalActorRef，那么在本地创建的Actor发消息还是跟以前一样的，那么如果如何给远程的Actor发消息呢？我们一般是通过actorSelection或者给远程Act">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679674-91d9cb18-d93a-406b-8e07-83f794ee0704.png#clientId=uefeb788d-1da0-4&from=paste&id=u03d3d04b&margin=%5Bobject%20Object%5D&originHeight=673&originWidth=940&originalType=url&ratio=1&status=done&style=none&taskId=uc9e1cf4b-77e2-46b0-900b-e572b8de1b2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679986-24a75e0b-3f0f-43cc-a5a0-cf6b35a042f0.png#clientId=uefeb788d-1da0-4&from=paste&id=udb08a09c&margin=%5Bobject%20Object%5D&originHeight=238&originWidth=637&originalType=url&ratio=1&status=done&style=none&taskId=udf6c091e-69f4-471f-95a8-c686b9c8d5f">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679699-6f455f3a-32d0-43db-bb1b-93ff16632324.png#clientId=uefeb788d-1da0-4&from=paste&id=u329a261e&margin=%5Bobject%20Object%5D&originHeight=581&originWidth=975&originalType=url&ratio=1&status=done&style=none&taskId=u73a9e1de-cdf2-4cb7-96bd-ed9634f99bb">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679686-443bd688-fb02-4177-b975-a746a41e2ae6.png#clientId=uefeb788d-1da0-4&from=paste&id=uc00650cc&margin=%5Bobject%20Object%5D&originHeight=826&originWidth=1163&originalType=url&ratio=1&status=done&style=none&taskId=u39d4310c-d4b5-4f72-9420-80ec90a1cf6">
<meta property="article:published_time" content="2021-12-03T07:48:55.013Z">
<meta property="article:modified_time" content="2021-12-03T09:07:15.176Z">
<meta property="article:author" content="wuhao">
<meta property="article:tag" content="akka">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679674-91d9cb18-d93a-406b-8e07-83f794ee0704.png#clientId=uefeb788d-1da0-4&from=paste&id=u03d3d04b&margin=%5Bobject%20Object%5D&originHeight=673&originWidth=940&originalType=url&ratio=1&status=done&style=none&taskId=uc9e1cf4b-77e2-46b0-900b-e572b8de1b2">
  <!-- Canonical links -->
  <link rel="canonical" href="https://wuhaocn.github.io/2021/12/03/network/akka/Akka-Remote-%E5%8F%91%E6%B6%88%E6%81%AF/index.html">
  
    <link rel="alternate" href="/atom.xml" title="wuhaocn" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/wuhaocn" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">wuhaocn</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Java &amp; 后端 &amp; 通信</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> BeiJing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">书单</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/wuhaocn" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/5G/">5G</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/devops/">devops</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9F%AD%E4%BF%A1/">短信</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80-shell/">编程语言 - shell</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/5G/" rel="tag">5G</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/" rel="tag">AOP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DPDK/" rel="tag">DPDK</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MEC/" rel="tag">MEC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NGAP/" rel="tag">NGAP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ai/" rel="tag">ai</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/akka/" rel="tag">akka</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/atomic/" rel="tag">atomic</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/brew/" rel="tag">brew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmpp/" rel="tag">cmpp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/" rel="tag">design</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftp/" rel="tag">ftp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grafana/" rel="tag">grafana</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/" rel="tag">jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nexus/" rel="tag">nexus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prometheus/" rel="tag">prometheus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/" rel="tag">sort</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF/" rel="tag">动态调试技术</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E8%8A%82%E7%A0%81/" rel="tag">字节码</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%88%87%E7%89%87/" rel="tag">网络切片</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/5G/" style="font-size: 13.33px;">5G</a> <a href="/tags/AOP/" style="font-size: 13px;">AOP</a> <a href="/tags/DPDK/" style="font-size: 13.17px;">DPDK</a> <a href="/tags/JVM/" style="font-size: 13.67px;">JVM</a> <a href="/tags/MEC/" style="font-size: 13px;">MEC</a> <a href="/tags/NGAP/" style="font-size: 13px;">NGAP</a> <a href="/tags/ai/" style="font-size: 13px;">ai</a> <a href="/tags/akka/" style="font-size: 14px;">akka</a> <a href="/tags/atomic/" style="font-size: 13.33px;">atomic</a> <a href="/tags/brew/" style="font-size: 13px;">brew</a> <a href="/tags/cmpp/" style="font-size: 13px;">cmpp</a> <a href="/tags/design/" style="font-size: 13px;">design</a> <a href="/tags/docker/" style="font-size: 13.5px;">docker</a> <a href="/tags/ftp/" style="font-size: 13px;">ftp</a> <a href="/tags/grafana/" style="font-size: 13px;">grafana</a> <a href="/tags/java/" style="font-size: 13px;">java</a> <a href="/tags/jenkins/" style="font-size: 13px;">jenkins</a> <a href="/tags/nexus/" style="font-size: 13px;">nexus</a> <a href="/tags/prometheus/" style="font-size: 13px;">prometheus</a> <a href="/tags/sort/" style="font-size: 13.83px;">sort</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF/" style="font-size: 13px;">动态调试技术</a> <a href="/tags/%E5%AD%97%E8%8A%82%E7%A0%81/" style="font-size: 13.33px;">字节码</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%88%87%E7%89%87/" style="font-size: 13px;">网络切片</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">24</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-SLF4J%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97/" class="title">Akka-SLF4J打印日志</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T09:08:28.304Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-Remote-%E9%85%8D%E7%BD%AE/" class="title">Akka-Remote-配置</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T08:24:00.895Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-%E6%8C%81%E4%B9%85%E5%8C%96-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E6%8E%A5%E6%94%B6/" class="title">Akka-持久化-消息发送与接收</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T08:23:51.202Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-Actor-DeadLetter%E7%9B%91%E5%90%AC/" class="title">Akka-Actor-DeadLetter监听</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T08:22:48.138Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/network/">network</a>
              </p>
              <p class="item-title">
                <a href="/2021/12/03/network/akka/Akka-Actor-%E7%9B%91%E7%AE%A1%E4%B8%8E%E5%AE%B9%E9%94%99/" class="title">Akka-Actor-监管与容错</a>
              </p>
              <p class="item-date">
                <time datetime="2021-12-03T08:22:40.247Z" itemprop="datePublished">2021-12-03</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<meta name="referrer" content="no-referrer" />
<main class="main" role="main">
  <div class="content">
  <article id="post-network/akka/Akka-Remote-发消息" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Akka-Remote-发消息
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/12/03/network/akka/Akka-Remote-%E5%8F%91%E6%B6%88%E6%81%AF/" class="article-date">
	  <time datetime="2021-12-03T07:48:55.013Z" itemprop="datePublished">2021-12-03</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/network/">network</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/akka/" rel="tag">akka</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/12/03/network/akka/Akka-Remote-%E5%8F%91%E6%B6%88%E6%81%AF/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><pre><code> 上文我们介绍了remote模式下Actor的创建，其实与local的创建并没有太大区别，一般情况下还是使用LocalActorRef创建了Actor。那么发消息是否意味着也是相同的呢？既然actorOf还是委托给了LocalActorRef，那么在本地创建的Actor发消息还是跟以前一样的，那么如果如何给远程的Actor发消息呢？我们一般是通过actorSelection或者给远程Actor发送一个Identify消息，来接收对应的ActorRef，然后再发消息。我们来分析一下这两者的区别。
</code></pre>
<h2 id="2-ActorSelection"><a href="#2-ActorSelection" class="headerlink" title="2.ActorSelection"></a>2.ActorSelection</h2><pre><code> 首先来看actorSelection，不管是用ActorSystem或者ActorContext的actorSelection方法，最终都是调用了ActorRefFactory对应的方法。
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Construct an [[akka.actor.ActorSelection]] from the given path, which is</span></span><br><span class="line"><span class="comment">   * parsed for wildcards (these are replaced by regular expressions</span></span><br><span class="line"><span class="comment">   * internally). No attempt is made to verify the existence of any part of</span></span><br><span class="line"><span class="comment">   * the supplied path, it is recommended to send a message and gather the</span></span><br><span class="line"><span class="comment">   * replies in order to resolve the matching set of actors.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">def <span class="title">actorSelection</span><span class="params">(path: String)</span>: ActorSelection </span>= path match &#123;</span><br><span class="line">    <span class="function"><span class="keyword">case</span> <span class="title">RelativeActorPath</span><span class="params">(elems)</span> ⇒</span></span><br><span class="line"><span class="function">      <span class="title">if</span> <span class="params">(elems.isEmpty)</span> <span class="title">ActorSelection</span><span class="params">(provider.deadLetters, <span class="string">&quot;&quot;</span>)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">else</span> <span class="title">if</span> <span class="params">(elems.head.isEmpty)</span> <span class="title">ActorSelection</span><span class="params">(provider.rootGuardian, elems.tail)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">else</span> <span class="title">ActorSelection</span><span class="params">(lookupRoot, elems)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">case</span> <span class="title">ActorPathExtractor</span><span class="params">(address, elems)</span> ⇒</span></span><br><span class="line"><span class="function">      <span class="title">ActorSelection</span><span class="params">(provider.rootGuardianAt(address)</span>, elems)</span></span><br><span class="line"><span class="function">    <span class="keyword">case</span> _ ⇒</span></span><br><span class="line"><span class="function">      <span class="title">ActorSelection</span><span class="params">(provider.deadLetters, <span class="string">&quot;&quot;</span>)</span></span></span><br><span class="line"><span class="function">  &#125;</span></span><br></pre></td></tr></table></figure>


<p>我们发现它支持两种类型的path：RelativeActorPath、ActorPathExtractor。<br>​</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Extractor for so-called “relative actor paths” as in “relative URI”, not in</span></span><br><span class="line"><span class="comment"> * “relative to some actor”. Examples:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * &quot;grand/child&quot;</span></span><br><span class="line"><span class="comment"> *  * &quot;/user/hello/world&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">object RelativeActorPath extends PathUtils &#123;</span><br><span class="line">  <span class="function">def <span class="title">unapply</span><span class="params">(addr: String)</span>: Option[immutable.Seq[String]] </span>= &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      val uri = <span class="keyword">new</span> URI(addr)</span><br><span class="line">      <span class="keyword">if</span> (uri.isAbsolute) <span class="function">None</span></span><br><span class="line"><span class="function">      <span class="keyword">else</span> <span class="title">Some</span><span class="params">(split(uri.getRawPath, uri.getRawFragment)</span>)</span></span><br><span class="line"><span class="function">    &#125; <span class="keyword">catch</span> </span>&#123;</span><br><span class="line">      <span class="keyword">case</span> _: URISyntaxException ⇒ None</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-1-RelativeActorPath"><a href="#2-1-RelativeActorPath" class="headerlink" title="2.1 RelativeActorPath"></a>2.1 RelativeActorPath</h3><pre><code>  RelativeActorPath提取器比较简单，就是创建了一个URI对象，然后判断其是否为Absolute，如果是就返回None，如果不是就返回对应的elemes。
  对于远程Actor，我们一般会指定主机名、端口号，例如akka.tcp://actorSystemName@10.0.0.1:2552/user/actorName，根据URI的定义，这个URI的schema是akka.tcp，很显然是Absolute，那就会返回None。
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Given an ActorPath it returns the Address and the path elements if the path is well-formed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">object ActorPathExtractor extends PathUtils &#123;</span><br><span class="line">  <span class="function">def <span class="title">unapply</span><span class="params">(addr: String)</span>: Option[<span class="params">(Address, immutable.Iterable[String])</span>] </span>=</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      val uri = <span class="keyword">new</span> URI(addr)</span><br><span class="line">      uri.getRawPath match &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">null</span> ⇒ None</span><br><span class="line">        <span class="keyword">case</span> path ⇒ AddressFromURIString.unapply(uri).map((_, split(path, uri.getRawFragment).drop(<span class="number">1</span>)))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> _: URISyntaxException ⇒ None</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-2-ActorPathExtractor"><a href="#2-2-ActorPathExtractor" class="headerlink" title="2.2  ActorPathExtractor"></a>2.2  ActorPathExtractor</h3><pre><code>     ActorPathExtractor这个提取器的名称定义的是有问题的，既然actorSelection只支持两种类型的路径选择：本地和远程。第一个解析器定义成相对路径，那么后面一个就直接是绝对路径好了啊，为啥用ActorPathExtractor这样蹩脚的命名？难道本地模式下，就不是ActorPath提取器了？我们来看看对于akka.tcp://actorSystemName@10.0.0.1:2552/user/actorName提取出了什么。经调试，address是akka.tcp://actorSystemName@10.0.0.1:2552，elems就是后面的user、actorName了。
</code></pre>
<p>也就是说remote模式下，如果有host、prot等信息就会返回_ActorSelection(provider.rootGuardianAt(address), elems)_这个类。不过好像无论哪种情况都返回这个类，好尴尬啊，但传入的第一个参数是不同的：provider.rootGuardianAt(address)。也就是说actorSelection这个函数是不区分当前的模式的，只要含有host/port就会传入provider.rootGuardianAt(address)，否则就传入provider.rootGuardian。如果在local模式下，也强制用actorSelection查找远程Actor会发生什么呢？我们来看看LocalActorRefProvider。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override def <span class="title">rootGuardianAt</span><span class="params">(address: Address)</span>: ActorRef </span>=</span><br><span class="line">  <span class="keyword">if</span> (address == rootPath.address) rootGuardian</span><br><span class="line">  <span class="keyword">else</span> deadLetters</span><br></pre></td></tr></table></figure>
<p>   local模式下，如果待查询actor的地址就是本地地址，则直接在本地返回查找；否则就返回deadLetters。其实是无法查找远程actor的。那么RemoteActorRefProvider呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">def <span class="title">rootGuardianAt</span><span class="params">(address: Address)</span>: ActorRef </span>= &#123;</span><br><span class="line">    <span class="keyword">if</span> (hasAddress(address)) rootGuardian</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> RemoteActorRef(transport, transport.localAddressForRemote(address),</span><br><span class="line">        RootActorPath(address), Nobody, props = None, deploy = None)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="function"><span class="keyword">case</span> <span class="title">NonFatal</span><span class="params">(e)</span> ⇒</span></span><br><span class="line"><span class="function">        log.<span class="title">error</span><span class="params">(e, <span class="string">&quot;No root guardian at [&#123;&#125;]&quot;</span>, address)</span></span></span><br><span class="line"><span class="function">        new <span class="title">EmptyLocalActorRef</span><span class="params">(<span class="keyword">this</span>, RootActorPath(address)</span>, eventStream)</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">  &#125;</span></span><br></pre></td></tr></table></figure>


<pre><code>    当然了，它也会判断一下本地地址是否包含待查询地址（防止多网卡或其他特殊情况），如果包含，则意味着是本地Actor交给rootGuardian；否则就创建RemoteActorRef。
     分析到这里我们知道了，其实在remote模式下，actorSelection返回了一个RemoteActorRef，还记得这个类的作用嘛？我们之前简单分析过，它其实是对远程Acotor的一个本地网络代理，也就是说所有通过actorSelection发送给远程actor的消息，都会经过他中转。我们继续分析ActorSelection的源码。
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Construct an ActorSelection from the given string representing a path</span></span><br><span class="line"><span class="comment">   * relative to the given target. This operation has to create all the</span></span><br><span class="line"><span class="comment">   * matching magic, so it is preferable to cache its result if the</span></span><br><span class="line"><span class="comment">   * intention is to send messages frequently.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">def <span class="title">apply</span><span class="params">(anchorRef: ActorRef, elements: Iterable[String])</span>: ActorSelection </span>= &#123;</span><br><span class="line">    val compiled: immutable.IndexedSeq[SelectionPathElement] = elements.collect(&#123;</span><br><span class="line">      <span class="keyword">case</span> x <span class="keyword">if</span> !x.isEmpty ⇒</span><br><span class="line">        <span class="keyword">if</span> ((x.indexOf(<span class="string">&#x27;?&#x27;</span>) != -<span class="number">1</span>) || (x.indexOf(<span class="string">&#x27;*&#x27;</span>) != -<span class="number">1</span>)) SelectChildPattern(x)</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="string">&quot;..&quot;</span>) <span class="function">SelectParent</span></span><br><span class="line"><span class="function">        <span class="keyword">else</span> <span class="title">SelectChildName</span><span class="params">(x)</span></span></span><br><span class="line"><span class="function">    &#125;)<span class="params">(scala.collection.breakOut)</span></span></span><br><span class="line"><span class="function">    new ActorSelection with ScalaActorSelection </span>&#123;</span><br><span class="line">      override val anchor = anchorRef</span><br><span class="line">      override val path = compiled</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<pre><code>    很显然这里的anchorRef是上面创建的RemoteActorRef实例，其中ActorSelection的anchor（锚定）是anchorRef。至此，一个ActorSelection创建完毕。那么如何发消息呢？这就需要分析tell或者！方法了。
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">def <span class="title">tell</span><span class="params">(msg: Any, sender: ActorRef)</span>: Unit </span>=</span><br><span class="line">  ActorSelection.deliverSelection(anchor.asInstanceOf[InternalActorRef], sender,</span><br><span class="line">    ActorSelectionMessage(msg, path, wildcardFanOut = <span class="keyword">false</span>))</span><br></pre></td></tr></table></figure>


<p>其实乍一看，我们应该明白，这就是在deliverSelection函数内部，把消息封装成ActorSelectionMessage发送给了anchor。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679674-91d9cb18-d93a-406b-8e07-83f794ee0704.png#clientId=uefeb788d-1da0-4&from=paste&id=u03d3d04b&margin=%5Bobject%20Object%5D&originHeight=673&originWidth=940&originalType=url&ratio=1&status=done&style=none&taskId=uc9e1cf4b-77e2-46b0-900b-e572b8de1b2"><br>​</p>
<pre><code>   该函数首先判断sel的elements是否为空，很显然不为空，进入rec函数。该函数比较复杂而且还是一个尾递归函数，但我们知道此处的ref就是RemoteActorRef，那么RemoteActorRef是不是一个ActorRefWithCell呢？
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span>[akka] <span class="class"><span class="keyword">class</span> <span class="title">RemoteActorRef</span> <span class="title">private</span>[<span class="title">akka</span>] (</span></span><br><span class="line"><span class="class">  <span class="title">remote</span>:                <span class="title">RemoteTransport</span>,</span></span><br><span class="line"><span class="class">  <span class="title">val</span> <span class="title">localAddressToUse</span>: <span class="title">Address</span>,</span></span><br><span class="line"><span class="class">  <span class="title">val</span> <span class="title">path</span>:              <span class="title">ActorPath</span>,</span></span><br><span class="line"><span class="class">  <span class="title">val</span> <span class="title">getParent</span>:         <span class="title">InternalActorRef</span>,</span></span><br><span class="line"><span class="class">  <span class="title">props</span>:                 <span class="title">Option</span>[<span class="title">Props</span>],</span></span><br><span class="line"><span class="class">  <span class="title">deploy</span>:                <span class="title">Option</span>[<span class="title">Deploy</span>])</span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">InternalActorRef</span> <span class="title">with</span> <span class="title">RemoteRef</span></span></span><br></pre></td></tr></table></figure>


<p>那么rec就会走到case _的逻辑，也就是把消息转发给了前面创建的RemoteActorRef，我们来看看这个示例是如何实现tell的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">override def !(message: Any)(implicit sender: ActorRef = Actor.noSender): Unit = &#123;</span><br><span class="line">    <span class="keyword">if</span> (message == <span class="keyword">null</span>) <span class="keyword">throw</span> InvalidMessageException(<span class="string">&quot;Message is null&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span> remote.send(message, OptionVal(sender), <span class="keyword">this</span>) <span class="function"><span class="keyword">catch</span> <span class="title">handleException</span><span class="params">(message, sender)</span></span></span><br><span class="line"><span class="function">  &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-RemoteActorRef"><a href="#2-3-RemoteActorRef" class="headerlink" title="2.3 RemoteActorRef"></a>2.3 RemoteActorRef</h3><pre><code>    RemoteActorRef这个类，通过remote把消息发送出去了，那么remote是什么呢？RemoteTransport是不是很熟悉？在ActorSystem启动的时候我们分析过这个对象，它是Remoting类的实例，Remoting里面send方法是怎样的呢？
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override def <span class="title">send</span><span class="params">(message: Any, senderOption: OptionVal[ActorRef], recipient: RemoteActorRef)</span>: Unit </span>= endpointManager match &#123;</span><br><span class="line">    <span class="function"><span class="keyword">case</span> <span class="title">Some</span><span class="params">(manager)</span> ⇒ manager.<span class="title">tell</span><span class="params">(Send(message, senderOption, recipient)</span>, sender </span>= senderOption getOrElse Actor.noSender)</span><br><span class="line">    <span class="keyword">case</span> None          ⇒ <span class="keyword">throw</span> <span class="keyword">new</span> RemoteTransportExceptionNoStackTrace(<span class="string">&quot;Attempted to send remote message but Remoting is not running.&quot;</span>, <span class="keyword">null</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-EndpointManager"><a href="#3-EndpointManager" class="headerlink" title="3. EndpointManager"></a>3. EndpointManager</h2><pre><code>   它又把消息转发给了manager，而manager就是endpointManager。endpointManager是不是也比较眼熟呢？前面文章中我们也见到过，这是一个EndpointManager实例，而EndpointManager是一个Actor。请注意这里用Send又对message进行了封装。EndpointManager是如何对Send消息进行反应的呢？
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> s @ Send(message, senderOption, recipientRef, _) ⇒</span><br><span class="line">      val recipientAddress = recipientRef.path.<span class="function">address</span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function">      def <span class="title">createAndRegisterWritingEndpoint</span><span class="params">()</span>: ActorRef </span>= &#123;</span><br><span class="line">        endpoints.registerWritableEndpoint(</span><br><span class="line">          recipientAddress,</span><br><span class="line">          uid = None,</span><br><span class="line">          createEndpoint(</span><br><span class="line">            recipientAddress,</span><br><span class="line">            recipientRef.localAddressToUse,</span><br><span class="line">            transportMapping(recipientRef.localAddressToUse),</span><br><span class="line">            settings,</span><br><span class="line">            handleOption = None,</span><br><span class="line">            writing = <span class="keyword">true</span>))</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      endpoints.writableEndpointWithPolicyFor(recipientAddress) match &#123;</span><br><span class="line">        <span class="function"><span class="keyword">case</span> <span class="title">Some</span><span class="params">(Pass(endpoint, _)</span>) ⇒</span></span><br><span class="line"><span class="function">          endpoint ! s</span></span><br><span class="line"><span class="function">        <span class="keyword">case</span> <span class="title">Some</span><span class="params">(Gated(timeOfRelease)</span>) ⇒</span></span><br><span class="line"><span class="function">          <span class="title">if</span> <span class="params">(timeOfRelease.isOverdue()</span>) <span class="title">createAndRegisterWritingEndpoint</span><span class="params">()</span> ! s</span></span><br><span class="line"><span class="function">          <span class="keyword">else</span> extendedSystem.deadLetters ! s</span></span><br><span class="line"><span class="function">        <span class="keyword">case</span> <span class="title">Some</span><span class="params">(Quarantined(uid, _)</span>) ⇒</span></span><br><span class="line"><span class="function">          <span class="comment">// timeOfRelease is only used for garbage collection reasons, therefore it is ignored here. We still have</span></span></span><br><span class="line"><span class="function">          <span class="comment">// the Quarantined tombstone and we know what UID we don&#x27;t want to accept, so use it.</span></span></span><br><span class="line"><span class="function">          <span class="title">createAndRegisterWritingEndpoint</span><span class="params">()</span> ! s</span></span><br><span class="line"><span class="function">        <span class="keyword">case</span> None ⇒</span></span><br><span class="line"><span class="function">          <span class="title">createAndRegisterWritingEndpoint</span><span class="params">()</span> ! s</span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function">      &#125;</span></span><br></pre></td></tr></table></figure>
<p>​</p>
<p>分析以上逻辑，简单来看，会先判断是不是存在一个endpoint，如果存在说明链接已经建立，可以直接发送，否则出于其他状态，就重新创建endpoint，然后把消息转发给该endpoint。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">def <span class="title">registerWritableEndpoint</span><span class="params">(address: Address, uid: Option[Int], endpoint: ActorRef)</span>: ActorRef </span>=</span><br><span class="line">      addressToWritable.get(address) match &#123;</span><br><span class="line">        <span class="function"><span class="keyword">case</span> <span class="title">Some</span><span class="params">(Pass(e, _)</span>) ⇒</span></span><br><span class="line"><span class="function">          throw new <span class="title">IllegalArgumentException</span><span class="params">(s<span class="string">&quot;Attempting to overwrite existing endpoint [$e] with [$endpoint]&quot;</span>)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">case</span> _ ⇒</span></span><br><span class="line"><span class="function">          <span class="comment">// note that this overwrites Quarantine marker,</span></span></span><br><span class="line"><span class="function">          <span class="comment">// but that is ok since we keep the quarantined uid in addressToRefuseUid</span></span></span><br><span class="line"><span class="function">          addressToWritable +</span>= address → Pass(endpoint, uid)</span><br><span class="line">          writableToAddress += endpoint → address</span><br><span class="line">          endpoint</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>registerWritableEndpoint没有太复杂的逻辑，就是查询addressToWritable这个HashMap，如果不存在则把对应的endpoint加入缓存，并返回endpoint。而endpoint是通过createEndpoint创建的。</p>
<h3 id="3-1-createEndpoint"><a href="#3-1-createEndpoint" class="headerlink" title="3.1 createEndpoint"></a>3.1 createEndpoint</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> def <span class="title">createEndpoint</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    remoteAddress:    Address,</span></span></span><br><span class="line"><span class="params"><span class="function">    localAddress:     Address,</span></span></span><br><span class="line"><span class="params"><span class="function">    transport:        AkkaProtocolTransport,</span></span></span><br><span class="line"><span class="params"><span class="function">    endpointSettings: RemoteSettings,</span></span></span><br><span class="line"><span class="params"><span class="function">    handleOption:     Option[AkkaProtocolHandle],</span></span></span><br><span class="line"><span class="params"><span class="function">    writing:          Boolean)</span>: ActorRef </span>= &#123;</span><br><span class="line">    require(transportMapping contains localAddress, <span class="string">&quot;Transport mapping is not defined for the address&quot;</span>)</span><br><span class="line">    <span class="comment">// refuseUid is ignored for read-only endpoints since the UID of the remote system is already known and has passed</span></span><br><span class="line">    <span class="comment">// quarantine checks</span></span><br><span class="line">    val refuseUid = endpoints.refuseUid(remoteAddress)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (writing) context.watch(context.actorOf(</span><br><span class="line">      RARP(extendedSystem).configureDispatcher(ReliableDeliverySupervisor.props(</span><br><span class="line">        handleOption,</span><br><span class="line">        localAddress,</span><br><span class="line">        remoteAddress,</span><br><span class="line">        refuseUid,</span><br><span class="line">        transport,</span><br><span class="line">        endpointSettings,</span><br><span class="line">        AkkaPduProtobufCodec,</span><br><span class="line">        receiveBuffers)).withDeploy(Deploy.local),</span><br><span class="line">      <span class="string">&quot;reliableEndpointWriter-&quot;</span> + AddressUrlEncoder(remoteAddress) + <span class="string">&quot;-&quot;</span> + endpointId.next()))</span><br><span class="line">    <span class="keyword">else</span> context.watch(context.actorOf(</span><br><span class="line">      RARP(extendedSystem).configureDispatcher(EndpointWriter.props(</span><br><span class="line">        handleOption,</span><br><span class="line">        localAddress,</span><br><span class="line">        remoteAddress,</span><br><span class="line">        refuseUid,</span><br><span class="line">        transport,</span><br><span class="line">        endpointSettings,</span><br><span class="line">        AkkaPduProtobufCodec,</span><br><span class="line">        receiveBuffers,</span><br><span class="line">        reliableDeliverySupervisor = None)).withDeploy(Deploy.local),</span><br><span class="line">      <span class="string">&quot;endpointWriter-&quot;</span> + AddressUrlEncoder(remoteAddress) + <span class="string">&quot;-&quot;</span> + endpointId.next()))</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


<p>createEndpoint最终创建了ReliableDeliverySupervisor这个Actor，也就是说RemoteActorRef最终又把消息发送给了ReliableDeliverySupervisor，ReliableDeliverySupervisor收到消息去调用handleSend方法。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679986-24a75e0b-3f0f-43cc-a5a0-cf6b35a042f0.png#clientId=uefeb788d-1da0-4&from=paste&id=udb08a09c&margin=%5Bobject%20Object%5D&originHeight=238&originWidth=637&originalType=url&ratio=1&status=done&style=none&taskId=udf6c091e-69f4-471f-95a8-c686b9c8d5f"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> def <span class="title">handleSend</span><span class="params">(send: Send)</span>: Unit </span>=</span><br><span class="line">  <span class="keyword">if</span> (send.message.isInstanceOf[SystemMessage]) &#123;</span><br><span class="line">    val sequencedSend = send.copy(seqOpt = Some(nextSeq()))</span><br><span class="line">    tryBuffer(sequencedSend)</span><br><span class="line">    <span class="comment">// If we have not confirmed the remote UID we cannot transfer the system message at this point just buffer it.</span></span><br><span class="line">    <span class="comment">// GotUid will kick resendAll() causing the messages to be properly written.</span></span><br><span class="line">    <span class="comment">// Flow control by not sending more when we already have many outstanding.</span></span><br><span class="line">    <span class="keyword">if</span> (uidConfirmed &amp;&amp; resendBuffer.nonAcked.size &lt;= settings.SysResendLimit)</span><br><span class="line">      writer ! sequencedSend</span><br><span class="line">  &#125; <span class="keyword">else</span> writer ! send</span><br></pre></td></tr></table></figure>
<p>除去特殊情况，用户发的普通消息又发送给了writer，艾玛我去，真是绕啊。writer是什么呢？</p>
<h3 id="3-2-createWriter"><a href="#3-2-createWriter" class="headerlink" title="3.2 createWriter"></a>3.2 createWriter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> writer: ActorRef = createWriter()</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> def <span class="title">createWriter</span><span class="params">()</span>: ActorRef </span>= &#123;</span><br><span class="line">    context.watch(context.actorOf(RARP(context.system).configureDispatcher(EndpointWriter.props(</span><br><span class="line">      handleOrActive = currentHandle,</span><br><span class="line">      localAddress = localAddress,</span><br><span class="line">      remoteAddress = remoteAddress,</span><br><span class="line">      refuseUid,</span><br><span class="line">      transport = transport,</span><br><span class="line">      settings = settings,</span><br><span class="line">      AkkaPduProtobufCodec,</span><br><span class="line">      receiveBuffers = receiveBuffers,</span><br><span class="line">      reliableDeliverySupervisor = Some(self))).withDeploy(Deploy.local), <span class="string">&quot;endpointWriter&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>很显然这又是一个Actor！！！哎，继续查找EndpointWriter这个Actor喽</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">def receive = <span class="keyword">if</span> (handle.isEmpty) initializing <span class="keyword">else</span> writing</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">val writing: Receive = &#123;</span><br><span class="line">    <span class="keyword">case</span> s: Send ⇒</span><br><span class="line">      <span class="keyword">if</span> (!writeSend(s)) &#123;</span><br><span class="line">        enqueueInBuffer(s)</span><br><span class="line">        scheduleBackoffTimer()</span><br><span class="line">        context.become(buffering)</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// We are in Writing state, so buffer is empty, safe to stop here</span></span><br><span class="line">    <span class="keyword">case</span> FlushAndStop ⇒</span><br><span class="line">      flushAndStop()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">case</span> AckIdleCheckTimer <span class="keyword">if</span> ackDeadline.isOverdue() ⇒</span><br><span class="line">      trySendPureAck()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这个Actor会先判断是否已经初始化，这里就假设初始化吧，初始化之后就会进入writing这个偏函数，对send类型的消息，又调用了writeSend函数。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679699-6f455f3a-32d0-43db-bb1b-93ff16632324.png#clientId=uefeb788d-1da0-4&from=paste&id=u329a261e&margin=%5Bobject%20Object%5D&originHeight=581&originWidth=975&originalType=url&ratio=1&status=done&style=none&taskId=u73a9e1de-cdf2-4cb7-96bd-ed9634f99bb"><br>这个函数简单来看，就是调用codec对消息进行序列化，然后创建了一个pdu，最终把pdu通过handle的write发送出去。handle又是什么呢？</p>
<h3 id="3-3-AkkaProtocolHandle"><a href="#3-3-AkkaProtocolHandle" class="headerlink" title="3.3 AkkaProtocolHandle"></a>3.3 AkkaProtocolHandle</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handle: Option[AkkaProtocolHandle] = handleOrActive</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>[remote] <span class="class"><span class="keyword">class</span> <span class="title">AkkaProtocolHandle</span>(</span></span><br><span class="line"><span class="class">  <span class="title">_localAddress</span>:          <span class="title">Address</span>,</span></span><br><span class="line"><span class="class">  <span class="title">_remoteAddress</span>:         <span class="title">Address</span>,</span></span><br><span class="line"><span class="class">  <span class="title">val</span> <span class="title">readHandlerPromise</span>: <span class="title">Promise</span>[<span class="title">HandleEventListener</span>],</span></span><br><span class="line"><span class="class">  <span class="title">_wrappedHandle</span>:         <span class="title">AssociationHandle</span>,</span></span><br><span class="line"><span class="class">  <span class="title">val</span> <span class="title">handshakeInfo</span>:      <span class="title">HandshakeInfo</span>,</span></span><br><span class="line"><span class="class">  <span class="title">private</span> <span class="title">val</span> <span class="title">stateActor</span>: <span class="title">ActorRef</span>,</span></span><br><span class="line"><span class="class">  <span class="title">private</span> <span class="title">val</span> <span class="title">codec</span>:      <span class="title">AkkaPduCodec</span>)</span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">AbstractTransportAdapterHandle</span>(<span class="title">_localAddress</span>, <span class="title">_remoteAddress</span>, <span class="title">_wrappedHandle</span>, <span class="title">AkkaScheme</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="function">override def <span class="title">write</span><span class="params">(payload: ByteString)</span>: Boolean </span>= wrappedHandle.write(codec.constructPayload(payload))</span><br><span class="line"> </span><br><span class="line">  <span class="function">override def <span class="title">disassociate</span><span class="params">()</span>: Unit </span>= disassociate(Unknown)</span><br><span class="line"> </span><br><span class="line">  <span class="function">def <span class="title">disassociate</span><span class="params">(info: DisassociateInfo)</span>: Unit </span>= stateActor ! DisassociateUnderlying(info)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>handle最终是一个AkkaProtocolHandle，这个对象我们不再具体分析，我们可以认为这是一个本地与远程地址链接的通道，通过这个通道就可以与远程actor发送消息了。</p>
<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h2><pre><code>  分析到这个地方，actorSelection与远程通信的过程大概就梳理清楚了。为了方便理解，作者特意辛苦的画了一个流程图，以供参考。细心的读者一定会问，那我的消息通过handle发送出去了，对方怎么接收呢？接收之后怎么发送到指定actor的邮箱呢？这一点我们后面再分析。
</code></pre>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/804884/1632642679686-443bd688-fb02-4177-b975-a746a41e2ae6.png#clientId=uefeb788d-1da0-4&from=paste&id=uc00650cc&margin=%5Bobject%20Object%5D&originHeight=826&originWidth=1163&originalType=url&ratio=1&status=done&style=none&taskId=u39d4310c-d4b5-4f72-9420-80ec90a1cf6"><br>actorSelection分析清楚了，剩下的就是通过ActorRef发送消息了。那么如何得到远程Actor的ActorRef呢？当然是“问”它了啊，怎么“问”呢？发消息啊。发什么消息呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A message all Actors will understand, that when processed will reply with</span></span><br><span class="line"><span class="comment"> * [[akka.actor.ActorIdentity]] containing the `ActorRef`. The `messageId`</span></span><br><span class="line"><span class="comment"> * is returned in the `ActorIdentity` message as `correlationId`.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SerialVersionUID(1L)</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">case</span> class <span class="title">Identify</span><span class="params">(messageId: Any)</span> extends AutoReceivedMessage with NotInfluenceReceiveTimeout</span></span><br></pre></td></tr></table></figure>


<p>官网对Identify的注释非常清楚，这个消息继承了AutoReceivedMessage，所有的Actor都理解该消息，且受到该消息后会返回akka.actor.ActorIdentity消息，里面包含当前Actor的ActorRef。那么所有的Actor为啥都理解该消息呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Memory consistency is handled by the Mailbox (reading mailbox status then processing messages, then writing mailbox status</span></span><br><span class="line">  <span class="function"><span class="keyword">final</span> def <span class="title">invoke</span><span class="params">(messageHandle: Envelope)</span>: Unit </span>= &#123;</span><br><span class="line">    val influenceReceiveTimeout = !messageHandle.message.isInstanceOf[NotInfluenceReceiveTimeout]</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      currentMessage = <span class="function">messageHandle</span></span><br><span class="line"><span class="function">      <span class="title">if</span> <span class="params">(influenceReceiveTimeout)</span></span></span><br><span class="line"><span class="function">        <span class="title">cancelReceiveTimeout</span><span class="params">()</span></span></span><br><span class="line"><span class="function">      messageHandle.message match </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> msg: AutoReceivedMessage ⇒ autoReceiveMessage(messageHandle)</span><br><span class="line">        <span class="keyword">case</span> msg                      ⇒ receiveMessage(msg)</span><br><span class="line">      &#125;</span><br><span class="line">      currentMessage = <span class="keyword">null</span> <span class="comment">// reset current message after successful invocation</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> handleNonFatalOrInterruptedException &#123; e ⇒</span><br><span class="line">      handleInvokeFailure(Nil, e)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (influenceReceiveTimeout)</span><br><span class="line">        checkReceiveTimeout <span class="comment">// Reschedule receive timeout</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="function">def <span class="title">autoReceiveMessage</span><span class="params">(msg: Envelope)</span>: Unit </span>= &#123;</span><br><span class="line">    <span class="keyword">if</span> (system.settings.DebugAutoReceive)</span><br><span class="line">      publish(Debug(self.path.toString, clazz(actor), <span class="string">&quot;received AutoReceiveMessage &quot;</span> + msg))</span><br><span class="line"> </span><br><span class="line">    msg.message match &#123;</span><br><span class="line">      <span class="keyword">case</span> t: Terminated              ⇒ receivedTerminated(t)</span><br><span class="line">      <span class="function"><span class="keyword">case</span> <span class="title">AddressTerminated</span><span class="params">(address)</span> ⇒ <span class="title">addressTerminated</span><span class="params">(address)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">case</span> Kill                       ⇒ throw <span class="title">ActorKilledException</span><span class="params">(<span class="string">&quot;Kill&quot;</span>)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">case</span> PoisonPill                 ⇒ self.<span class="title">stop</span><span class="params">()</span></span></span><br><span class="line"><span class="function">      <span class="keyword">case</span> sel: ActorSelectionMessage ⇒ <span class="title">receiveSelection</span><span class="params">(sel)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">case</span> <span class="title">Identify</span><span class="params">(messageId)</span>        ⇒ <span class="title">sender</span><span class="params">()</span> ! <span class="title">ActorIdentity</span><span class="params">(messageId, Some(self)</span>)</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">  &#125;　</span></span><br></pre></td></tr></table></figure>
<p>如果读者看过我之前分析的文章对上面的代码一定还有印象，它是ActorCell里面处理消息的两个函数，invoke会先判断消息类型是不是AutoReceivedMessage，如果是就自己处理了，不会去调用开发者自定义的receive函数。而Identify属于AutoReceivedMessage，收到后给sender发送了ActorIdentity消息，该消息的第二个参数是当前Actor的ActorFef变量。这样本地的actor收到远程actor返回的ActorIdentity，就可以通过对方的ActorRef给它发送消息了。当然本地actor收到的ActorIdentity消息中，第二个参数应该是一个RemoteActorRef类型。如何通过RemoteActorRef发送消息，上文已经分析清楚了，其实actorSelection最终也是通过远程actor的ActorPath创建了对应的RemoteActorRef，来发送消息的。<br>至此给远程actor发消息的两种方法就讲解完毕了。其实还有<a target="_blank" rel="noopener" href="https://doc.akka.io/docs/akka/current/remoting.html#creating-actors-remotely">第三种方式</a>，就是在本地创建一个远程Actor，当然了最终还是需要通过RemoteActorRef发消息的，这个具体就不再详细介绍了。</p>
<h2 id="5-参考"><a href="#5-参考" class="headerlink" title="5.参考"></a>5.参考</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gabry/p/9377182.html">https://www.cnblogs.com/gabry/p/9377182.html</a></p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://wuhaocn.github.io/2021/12/03/network/akka/Akka-Remote-%E5%8F%91%E6%B6%88%E6%81%AF/" title="Akka-Remote-发消息" target="_blank" rel="external">https://wuhaocn.github.io/2021/12/03/network/akka/Akka-Remote-发消息/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/wuhaocn" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/wuhaocn" target="_blank"><span class="text-dark">wuhaocn</span><small class="ml-1x">Java &amp; 后端 &amp; 通信</small></a></h3>
        <div>个人简介。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/12/03/network/akka/Akka-Remote-%E6%94%B6%E6%B6%88%E6%81%AF/" title="Akka-Remote-收消息"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/12/03/network/akka/Akka-Actor-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" title="Akka-Actor-生命周期"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/wuhaocn" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/wuhaocn" target="_blank"> cofess </a>base on <a href="https://github.com/wuhaocn/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'UWmpsjuNfPNkkicYrPtMzVQC-gzGzoHsz',
    appKey: '825aG0XPHawp6VAXnYsrnlp3',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>